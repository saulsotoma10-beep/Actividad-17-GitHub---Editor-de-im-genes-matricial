name: ğŸ“ CalificaciÃ³n AutomÃ¡tica - Editor de ImÃ¡genes Matricial

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout del cÃ³digo
      uses: actions/checkout@v3
      
    - name: ğŸ”§ Configurar Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Instalar dependencias
      run: npm install
      
    - name: ğŸ¨ Generar imÃ¡genes de prueba
      run: npm run generar-imagenes
      continue-on-error: true
      
    - name: ğŸ§ª Ejecutar tests
      run: npm test
      
    - name: ğŸ“Š Generar reporte de cobertura
      run: npm run test:coverage
      continue-on-error: true
      
    - name: ğŸ“¸ Guardar imÃ¡genes generadas
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: imagenes-generadas
        path: imagenes/salida/
        retention-days: 30
        
    - name: ğŸ“ˆ Mostrar estadÃ­sticas
      if: always()
      run: |
        echo "=================================="
        echo "âœ… Tests completados"
        echo "=================================="
        echo ""
        echo "ğŸ“ Revisa la pestaÃ±a 'Actions' para ver tu calificaciÃ³n"
        echo "ğŸ¯ Los resultados aparecen arriba en 'Ejecutar tests'"
        echo "ğŸ–¼ï¸  Las imÃ¡genes generadas estÃ¡n disponibles en 'Artifacts'"
        echo ""
        
    - name: ğŸ‰ Â¡Ã‰xito!
      if: success()
      run: |
        echo "=================================="
        echo "ğŸ‰ Â¡Felicidades!"
        echo "=================================="
        echo "âœ… Todos los tests pasaron correctamente"
        echo "ğŸ“Š Tu cÃ³digo estÃ¡ listo para ser calificado"
        echo ""
        echo "ğŸ’¡ Tips:"
        echo "   - Revisa los logs arriba para ver tu puntuaciÃ³n"
        echo "   - Las imÃ¡genes generadas estÃ¡n en imagenes/salida/"
        echo "   - Puedes ejecutar 'npm test' localmente para ver resultados"
        echo ""
        
    - name: âš ï¸ Algunos tests fallaron
      if: failure()
      run: |
        echo "=================================="
        echo "âš ï¸ AtenciÃ³n"
        echo "=================================="
        echo "âŒ Algunos tests no pasaron"
        echo ""
        echo "ğŸ’¡ QuÃ© hacer:"
        echo "   1. Revisa los errores arriba en rojo"
        echo "   2. Lee el mensaje de error de cada test"
        echo "   3. Corrige tu cÃ³digo en src/ejercicios.js"
        echo "   4. Haz commit y push de nuevo"
        echo ""
        echo "ğŸ”§ Para debuggear localmente:"
        echo "   npm install"
        echo "   npm test"
        echo ""
